!function(t,r)***REMOVED***"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.ColorThief=r()***REMOVED***(this,function()***REMOVED***function s(t)***REMOVED***this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)***REMOVED***var y,C,_=_||***REMOVED***map:function(t,n)***REMOVED***var o=***REMOVED******REMOVED***;return n?t.map(function(t,r)***REMOVED***return o.index=r,n.call(o,t)***REMOVED***):t.slice()***REMOVED***,naturalOrder:function(t,r)***REMOVED***return t<r?-1:r<t?1:0***REMOVED***,sum:function(t,o)***REMOVED***var e=***REMOVED******REMOVED***;return t.reduce(o?function(t,r,n)***REMOVED***return e.index=n,t+o.call(e,r)***REMOVED***:function(t,r)***REMOVED***return t+r***REMOVED***,0)***REMOVED***,max:function(t,r)***REMOVED***return Math.max.apply(null,r?_.map(t,r):t)***REMOVED******REMOVED***,a=(C=8-(y=5),z.prototype=***REMOVED***volume:function(t)***REMOVED***return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume***REMOVED***,count:function(t)***REMOVED***var r=this.histo;if(!this._count_set||t)***REMOVED***for(var n,o,e=0,i=this.r1;i<=this.r2;i++)for(n=this.g1;n<=this.g2;n++)for(o=this.b1;o<=this.b2;o++)e+=r[E(i,n,o)]||0;this._count=e,this._count_set=!0***REMOVED***return this._count***REMOVED***,copy:function()***REMOVED***return new z(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)***REMOVED***,avg:function(t)***REMOVED***var r=this.histo;if(!this._avg||t)***REMOVED***for(var n,o,e,i=0,u=1<<8-y,s=0,a=0,h=0,c=this.r1;c<=this.r2;c++)for(o=this.g1;o<=this.g2;o++)for(e=this.b1;e<=this.b2;e++)i+=n=r[E(c,o,e)]||0,s+=n*(c+.5)*u,a+=n*(o+.5)*u,h+=n*(e+.5)*u;this._avg=i?[~~(s/i),~~(a/i),~~(h/i)]:[~~(u*(this.r1+this.r2+1)/2),~~(u*(this.g1+this.g2+1)/2),~~(u*(this.b1+this.b2+1)/2)]***REMOVED***return this._avg***REMOVED***,contains:function(t)***REMOVED***var r=t[0]>>C;return gval=t[1]>>C,bval=t[2]>>C,r>=this.r1&&r<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2***REMOVED******REMOVED***,I.prototype=***REMOVED***push:function(t)***REMOVED***this.vboxes.push(***REMOVED***vbox:t,color:t.avg()***REMOVED***)***REMOVED***,palette:function()***REMOVED***return this.vboxes.map(function(t)***REMOVED***return t.color***REMOVED***)***REMOVED***,size:function()***REMOVED***return this.vboxes.size()***REMOVED***,map:function(t)***REMOVED***for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)***REMOVED***,nearest:function(t)***REMOVED***for(var r,n,o,e=this.vboxes,i=0;i<e.size();i++)((n=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)))<r||void 0===r)&&(r=n,o=e.peek(i).color);return o***REMOVED***,forcebw:function()***REMOVED***var t=this.vboxes;t.sort(function(t,r)***REMOVED***return _.naturalOrder(_.sum(t.color),_.sum(r.color))***REMOVED***);var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;251<o[0]&&251<o[1]&&251<o[2]&&(t[n].color=[255,255,255])***REMOVED******REMOVED***,function(t,r)***REMOVED***if(!t.length||r<2||256<r)return!1;var n,o,e,a=(n=t,e=new Array(1<<3*y),n.forEach(function(t)***REMOVED***o=E(t[0]>>C,t[1]>>C,t[2]>>C),e[o]=(e[o]||0)+1***REMOVED***),e);a.forEach(function()***REMOVED******REMOVED***);var i,u,s,h,c,f,l,v,g,p,d=(i=a,g=l=c=1e6,p=v=f=0,t.forEach(function(t)***REMOVED***(u=t[0]>>C)<c?c=u:f<u&&(f=u),(s=t[1]>>C)<l?l=s:v<s&&(v=s),(h=t[2]>>C)<g?g=h:p<h&&(p=h)***REMOVED***),new z(c,f,l,v,g,p,i)),b=new M(function(t,r)***REMOVED***return _.naturalOrder(t.count(),r.count())***REMOVED***);function m(t,r)***REMOVED***for(var n,o=t.size(),e=0;e<1e3;)***REMOVED***if(r<=o)return;if(1e3<e++)return;if((n=t.pop()).count())***REMOVED***var i=k(a,n),u=i[0],s=i[1];if(!u)return;t.push(u),s&&(t.push(s),o++)***REMOVED***else t.push(n),e++***REMOVED******REMOVED***b.push(d),m(b,.75*r);for(var w=new M(function(t,r)***REMOVED***return _.naturalOrder(t.count()*t.volume(),r.count()*r.volume())***REMOVED***);b.size();)w.push(b.pop());m(w,r);for(var x=new I;w.size();)x.push(w.pop());return x***REMOVED***);function E(t,r,n)***REMOVED***return(t<<2*y)+(r<<y)+n***REMOVED***function M(t)***REMOVED***var r=[],n=!1;function o()***REMOVED***r.sort(t),n=!0***REMOVED***return***REMOVED***push:function(t)***REMOVED***r.push(t),n=!1***REMOVED***,peek:function(t)***REMOVED***return n||o(),void 0===t&&(t=r.length-1),r[t]***REMOVED***,pop:function()***REMOVED***return n||o(),r.pop()***REMOVED***,size:function()***REMOVED***return r.length***REMOVED***,map:function(t)***REMOVED***return r.map(t)***REMOVED***,debug:function()***REMOVED***return n||o(),r***REMOVED******REMOVED******REMOVED***function z(t,r,n,o,e,i,u)***REMOVED***this.r1=t,this.r2=r,this.g1=n,this.g2=o,this.b1=e,this.b2=i,this.histo=u***REMOVED***function I()***REMOVED***this.vboxes=new M(function(t,r)***REMOVED***return _.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())***REMOVED***)***REMOVED***function k(t,h)***REMOVED***if(h.count())***REMOVED***var r=h.r2-h.r1+1,n=h.g2-h.g1+1,o=_.max([r,n,h.b2-h.b1+1]);if(1==h.count())return[h.copy()];var c,e,i,u,f=0,l=[],v=[];if(o==r)for(c=h.r1;c<=h.r2;c++)***REMOVED***for(u=0,e=h.g1;e<=h.g2;e++)for(i=h.b1;i<=h.b2;i++)u+=t[E(c,e,i)]||0;l[c]=f+=u***REMOVED***else if(o==n)for(c=h.g1;c<=h.g2;c++)***REMOVED***for(u=0,e=h.r1;e<=h.r2;e++)for(i=h.b1;i<=h.b2;i++)u+=t[E(e,c,i)]||0;l[c]=f+=u***REMOVED***else for(c=h.b1;c<=h.b2;c++)***REMOVED***for(u=0,e=h.r1;e<=h.r2;e++)for(i=h.g1;i<=h.g2;i++)u+=t[E(e,i,c)]||0;l[c]=f+=u***REMOVED***return l.forEach(function(t,r)***REMOVED***v[r]=f-t***REMOVED***),function(t)***REMOVED***var r,n,o,e,i,u=t+"1",s=t+"2",a=0;for(c=h[u];c<=h[s];c++)if(l[c]>f/2)***REMOVED***for(o=h.copy(),e=h.copy(),i=(r=c-h[u])<=(n=h[s]-c)?Math.min(h[s]-1,~~(c+n/2)):Math.max(h[u],~~(c-1-r/2));!l[i];)i++;for(a=v[i];!a&&l[i-1];)a=v[--i];return o[s]=i,e[u]=o[s]+1,[o,e]***REMOVED******REMOVED***(o==r?"r":o==n?"g":"b")***REMOVED******REMOVED***s.prototype.getImageData=function()***REMOVED***return this.context.getImageData(0,0,this.width,this.height)***REMOVED***;function t()***REMOVED******REMOVED***return t.prototype.getColor=function(t,r)***REMOVED***return void 0===r&&(r=10),this.getPalette(t,5,r)[0]***REMOVED***,t.prototype.getPalette=function(t,r,n)***REMOVED***var o=function(t)***REMOVED***var r=t.colorCount,n=t.quality;if(void 0!==r&&Number.isInteger(r))***REMOVED***if(1===r)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)***REMOVED***else r=10;return(void 0===n||!Number.isInteger(n)||n<1)&&(n=10),***REMOVED***colorCount:r,quality:n***REMOVED******REMOVED***(***REMOVED***colorCount:r,quality:n***REMOVED***),e=new s(t),i=function(t,r,n)***REMOVED***for(var o=t,e=[],i=0,u=void 0,s=void 0,a=void 0,h=void 0,c=void 0;i<r;i+=n)s=o[0+(u=4*i)],a=o[u+1],h=o[u+2],(void 0===(c=o[u+3])||125<=c)&&(250<s&&250<a&&250<h||e.push([s,a,h]));return e***REMOVED***(e.getImageData().data,e.width*e.height,o.quality),u=a(i,o.colorCount);return u?u.palette():null***REMOVED***,t.prototype.getColorFromUrl=function(r,n,o)***REMOVED***var e=this,i=document.createElement("img");i.addEventListener("load",function()***REMOVED***var t=e.getPalette(i,5,o);n(t[0],r)***REMOVED***),i.src=r***REMOVED***,t.prototype.getImageData=function(t,u)***REMOVED***var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function()***REMOVED***if(200==this.status)***REMOVED***var t=new Uint8Array(this.response);i=t.length;for(var r=new Array(i),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);var o=r.join(""),e=window.btoa(o);u("data:image/png;base64,"+e)***REMOVED******REMOVED***,r.send()***REMOVED***,t.prototype.getColorAsync=function(t,n,o)***REMOVED***var e=this;this.getImageData(t,function(t)***REMOVED***var r=document.createElement("img");r.addEventListener("load",function()***REMOVED***var t=e.getPalette(r,5,o);n(t[0],this)***REMOVED***),r.src=t***REMOVED***)***REMOVED***,t***REMOVED***);
